import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card';
import {
  COMMUNICATION_ADJUSTMENTS,
  SUPPORT_NEEDS,
  VULNERABILITY_FACTORS
} from '@/components/clients/form/constants';
import type { ClientFormData, VulnerabilityAssessment } from '@/types/client';

type VulnerabilityListField = 'vulnerabilityFactors' | 'supportNeeds' | 'communicationAdjustments';

interface VulnerabilityAssessmentStepProps {
  formData: ClientFormData;
  onUpdateVulnerabilityAssessment: (updates: Partial<VulnerabilityAssessment>) => void;
  onToggleList: (field: VulnerabilityListField, value: string) => void;
}

export function VulnerabilityAssessmentStep({
  formData,
  onUpdateVulnerabilityAssessment,
  onToggleList
}: VulnerabilityAssessmentStepProps) {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Vulnerability Assessment</CardTitle>
      </CardHeader>
      <CardContent className="space-y-5 sm:space-y-4">
        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p className="text-sm text-blue-800">
            This assessment helps us comply with the Consumer Duty regulations and ensure appropriate support is provided.
          </p>
        </div>

        <div>
          <label className="flex items-center space-x-2">
            <input
              type="checkbox"
              checked={formData.vulnerabilityAssessment?.is_vulnerable || false}
              onChange={(e) => onUpdateVulnerabilityAssessment({ is_vulnerable: e.target.checked })}
              className="rounded border-gray-300"
            />
            <span className="text-sm font-medium text-gray-700">Client may be considered vulnerable</span>
          </label>
        </div>

        {formData.vulnerabilityAssessment?.is_vulnerable && (
          <div className="space-y-4">
            <div>
              <p className="text-sm font-medium text-gray-700 mb-2">Vulnerability factors</p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                {VULNERABILITY_FACTORS.map((factor) => (
                  <label key={factor.id} className="flex items-center gap-2 text-sm text-gray-700">
                    <input
                      type="checkbox"
                      checked={(formData.vulnerabilityAssessment?.vulnerabilityFactors || []).includes(factor.id)}
                      onChange={() => onToggleList('vulnerabilityFactors', factor.id)}
                      className="rounded border-gray-300"
                    />
                    {factor.label}
                  </label>
                ))}
              </div>
            </div>

            <div>
              <p className="text-sm font-medium text-gray-700 mb-2">Support needs</p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                {SUPPORT_NEEDS.map((need) => (
                  <label key={need.id} className="flex items-center gap-2 text-sm text-gray-700">
                    <input
                      type="checkbox"
                      checked={(formData.vulnerabilityAssessment?.supportNeeds || []).includes(need.id)}
                      onChange={() => onToggleList('supportNeeds', need.id)}
                      className="rounded border-gray-300"
                    />
                    {need.label}
                  </label>
                ))}
              </div>
            </div>

            <div>
              <p className="text-sm font-medium text-gray-700 mb-2">Communication adjustments</p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                {COMMUNICATION_ADJUSTMENTS.map((adjustment) => (
                  <label key={adjustment.id} className="flex items-center gap-2 text-sm text-gray-700">
                    <input
                      type="checkbox"
                      checked={(formData.vulnerabilityAssessment?.communicationAdjustments || []).includes(adjustment.id)}
                      onChange={() => onToggleList('communicationAdjustments', adjustment.id)}
                      className="rounded border-gray-300"
                    />
                    {adjustment.label}
                  </label>
                ))}
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Assessment date</label>
                <input
                  type="date"
                  value={formData.vulnerabilityAssessment?.assessmentDate?.slice(0, 10) || ''}
                  onChange={(e) => onUpdateVulnerabilityAssessment({ assessmentDate: e.target.value })}
                  className="w-full p-2 border border-gray-300 rounded-md text-base sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Review date</label>
                <input
                  type="date"
                  value={formData.vulnerabilityAssessment?.reviewDate?.slice(0, 10) || ''}
                  onChange={(e) => onUpdateVulnerabilityAssessment({ reviewDate: e.target.value })}
                  className="w-full p-2 border border-gray-300 rounded-md text-base sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Assessment Notes</label>
            <textarea
              rows={4}
              value={formData.vulnerabilityAssessment?.assessmentNotes || ''}
              onChange={(e) => onUpdateVulnerabilityAssessment({ assessmentNotes: e.target.value })}
              className="w-full p-2 border border-gray-300 rounded-md text-base sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Describe any vulnerability factors and support needs..."
            />
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
