import type { ConditionalRule } from '../types'

export const vulnerabilityRules: ConditionalRule[] = [
  // ===== VULNERABILITY ASSESSMENT (Rules 33-37) =====
  {
    id: 'age_vulnerability',
    name: 'Trigger vulnerability for elderly',
    sections: ['vulnerability_assessment', 'personal_information'],
    priority: 33,
    condition: (formData) => (formData.personal_information?.age || 0) > 75,
    actions: [
      {
        type: 'show_field',
        sectionId: 'vulnerability_assessment',
        fields: [
          {
            id: 'cognitive_ability',
            label: 'Cognitive Ability',
            type: 'select',
            options: ['Fully Capable', 'Some Assistance Needed', 'Significant Support Required'],
            required: true
          },
          {
            id: 'power_of_attorney',
            label: 'Power of Attorney in Place?',
            type: 'radio',
            options: ['Yes', 'No', 'In Progress']
          }
        ]
      },
      {
        type: 'validate',
        sectionId: 'objectives',
        message: 'Client is over 75. Consider estate planning and lasting power of attorney review.'
      }
    ]
  },

  {
    id: 'health_vulnerability',
    name: 'Enhanced support for health concerns',
    sections: ['vulnerability_assessment'],
    priority: 34,
    condition: (formData) => {
      const healthConditions = String((formData.vulnerability_assessment as any)?.health_conditions || '').toLowerCase()
      const legacy = String((formData.vulnerability_assessment as any)?.health_concerns || '').toLowerCase()
      return healthConditions === 'yes' || legacy.includes('moderate') || legacy.includes('significant')
    },
    actions: [
      {
        type: 'show_field',
        sectionId: 'vulnerability_assessment',
        fields: [
          {
            id: 'communication_preferences',
            label: 'Communication Preferences',
            type: 'checkbox',
            options: ['Large Print', 'Audio', 'Video Calls', 'Face-to-Face', 'Written Summary'],
            required: true
          },
          {
            id: 'support_person',
            label: 'Support Person Details',
            type: 'textarea',
            placeholder: 'Name and relationship of support person if applicable'
          }
        ]
      }
    ]
  },
  {
    id: 'health_protection_prompt',
    name: 'Prompt protection review for health concerns',
    sections: ['vulnerability_assessment', 'existing_arrangements'],
    priority: 34.5,
    condition: (formData) => {
      const healthConditions = String((formData.vulnerability_assessment as any)?.health_conditions || '').toLowerCase()
      return healthConditions === 'yes'
    },
    actions: [
      {
        type: 'validate',
        sectionId: 'existing_arrangements',
        message: 'Health conditions noted. Consider reviewing protection needs and cover adequacy.'
      }
    ]
  },

  {
    id: 'life_event_vulnerability',
    name: 'Support for major life events',
    sections: ['vulnerability_assessment'],
    priority: 35,
    condition: (formData) => {
      const events = formData.vulnerability_assessment?.life_events || []
      const significantEvents = ['Bereavement', 'Divorce/Separation', 'Job Loss', 'Health Diagnosis', 'Retirement']
      return events.length > 0 && events.some((event) => significantEvents.includes(event))
    },
    actions: [
      {
        type: 'show_field',
        sectionId: 'vulnerability_assessment',
        fields: [
          {
            id: 'cooling_off_period',
            label: 'Prefer Cooling-Off Period?',
            type: 'radio',
            options: ['Yes - 30 days', 'Yes - 60 days', 'No'],
            helpText: 'Time to reconsider major financial decisions'
          },
          {
            id: 'emotional_support',
            label: 'Additional Support Needed?',
            type: 'checkbox',
            options: ['Counseling Resources', 'Family Involvement', 'Gradual Implementation']
          }
        ]
      }
    ]
  }
]
