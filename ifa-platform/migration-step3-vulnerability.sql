-- STEP 3: Create vulnerability_assessments table

CREATE TABLE vulnerability_assessments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  client_id UUID,
  firm_id UUID,
  is_vulnerable BOOLEAN DEFAULT false,
  vulnerability_factors JSONB DEFAULT '[]',
  health_factors JSONB DEFAULT '{}',
  life_events_factors JSONB DEFAULT '{}',
  resilience_factors JSONB DEFAULT '{}',
  capability_factors JSONB DEFAULT '{}',
  overall_risk_level TEXT DEFAULT 'low',
  support_measures JSONB DEFAULT '[]',
  notes TEXT,
  assessed_by UUID,
  assessed_at TIMESTAMPTZ DEFAULT NOW(),
  review_date TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE vulnerability_assessments ENABLE ROW LEVEL SECURITY;
CREATE POLICY "allow_all_vuln" ON vulnerability_assessments FOR ALL USING (true) WITH CHECK (true);

SELECT 'Vulnerability assessments table created!' as result;
